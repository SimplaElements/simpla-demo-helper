<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../paper-toggle-button/paper-toggle-button.html"> <link rel="import" href="../simpla-styles/colors.html"> <dom-module id="simpla-demo-helper"> <template> <style>*,::after,::before,:host{box-sizing:border-box}:host{margin:0 auto;max-width:38rem}.wrapper{display:flex;align-items:center;justify-content:space-between;padding:1.25rem;border:1px solid var(--simpla-grey-100);background:var(--simpla-grey-50);border-radius:3px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased}.label{font-family:sans-serif;font-size:.9em;font-weight:600;color:var(--simpla-grey-700)}.toggle{--primary-color:var(--simpla-primary-color);--paper-toggle-button-unchecked-button-color:white;--paper-toggle-button-unchecked-bar-color:var(--simpla-grey-700)}</style> <div class="wrapper"> <span class="label">Toggle edit mode</span> <paper-toggle-button class="toggle" checked="{{editable}}" noink=""> </paper-toggle-button> </div> </template> <script>function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function unwrapExports(e){return e&&e.__esModule?e.default:e}function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function getRawTag(e){var t=hasOwnProperty$1.call(e,symToStringTag$1),n=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var r=!0}catch(e){}var o=nativeObjectToString.call(e);return r&&(t?e[symToStringTag$1]=n:delete e[symToStringTag$1]),o}function objectToString(e){return nativeObjectToString$1.call(e)}function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function overArg(e,t){return function(n){return e(t(n))}}function isObjectLike(e){return null!=e&&"object"==typeof e}function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=objectTag)return!1;var t=getPrototype(e);if(null===t)return!0;var n=hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&funcToString.call(n)==objectCtorString}function createStore(e,t,n){function r(){p===d&&(p=d.slice())}function o(){return l}function i(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return r(),p.push(e),function(){if(t){t=!1,r();var n=p.indexOf(e);p.splice(n,1)}}}function u(e){if(!isPlainObject(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw new Error("Reducers may not dispatch actions.");try{h=!0,l=f(l,e)}finally{h=!1}for(var t=d=p,n=0;n<t.length;n++)t[n]();return e}function s(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");f=e,u({type:ActionTypes.INIT})}function a(){var e,t=i;return e={subscribe:function(e){function n(){e.next&&e.next(o())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");n();var r=t(n);return{unsubscribe:r}}},e[index]=function(){return this},e}var c;if("function"==typeof t&&"undefined"==typeof n&&(n=t,t=void 0),"undefined"!=typeof n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(createStore)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var f=e,l=t,d=[],p=d,h=!1;return u({type:ActionTypes.INIT}),c={dispatch:u,subscribe:i,getState:o,replaceReducer:s},c[index]=a,c}function warning(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}function getUndefinedStateErrorMessage(e,t){var n=t&&t.type,r=n&&'"'+n.toString()+'"'||"an action";return"Given action "+r+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function assertReducerSanity(e){Object.keys(e).forEach(function(t){var n=e[t],r=n(void 0,{type:ActionTypes.INIT});if("undefined"==typeof r)throw new Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');var o="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if("undefined"==typeof n(void 0,{type:o}))throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.")})}function combineReducers(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var o=t[r];"function"==typeof e[o]&&(n[o]=e[o])}var i,u=Object.keys(n);try{assertReducerSanity(n)}catch(e){i=e}return function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1];if(i)throw i;for(var r=!1,o={},s=0;s<u.length;s++){var a=u[s],c=n[a],f=e[a],l=c(f,t);if("undefined"==typeof l){var d=getUndefinedStateErrorMessage(a,t);throw new Error(d)}o[a]=l,r=r||l!==f}return r?o:e}}function compose(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return function(e){return e};if(1===t.length)return t[0];var r=t[t.length-1],o=t.slice(0,-1);return function(){return o.reduceRight(function(e,t){return t(e)},r.apply(void 0,arguments))}}function applyMiddleware(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(n,r,o){var i=e(n,r,o),u=i.dispatch,s=[],a={getState:i.getState,dispatch:function(e){return u(e)}};return s=t.map(function(e){return e(a)}),u=compose.apply(void 0,s)(i.dispatch),_extends({},i,{dispatch:u})}}}function isCrushed(){}function setOption(t,n){return{type:e,prop:t,value:n}}function editActive(){return{type:x}}function editInactive(){return{type:k}}function checkStatus(e){let t;return e.ok?e:(t=((t={})=>{let n=t.code||e.status,r=t.statusText||e.statusText,o=new Error(r);return o.code=n,o.statusText=r,Promise.reject(o)}),Promise.resolve().then(()=>e.json()).then(e=>t(e),()=>t({code:e.status,statusText:e.statusText})))}function request(e){let t=Object.assign({},e);return t.headers=Object.assign({Accept:"application/json"},t.headers),e.body&&(t.body=JSON.stringify(e.body),t.headers=Object.assign({"Content-Type":"application/json"},t.headers)),fetch$1(e.url,t).then(checkStatus).then(e=>204===e.status?null:e.json())}function requestWithToken(e){let t=e.token;return t&&(e.headers=Object.assign({Authorization:`Bearer ${t}`},e.headers)),request(e)}function syncLogin({email,password}){return{type:t,email:email,password:password}}function loginSuccessful(e){return{type:n,response:e}}function loginFailed(e){return{type:r,response:e}}function login({email,password}){return(e,t)=>{let{authEndpoint}=t().config;return e(syncLogin({email:email,password:password})),client.post(`${authEndpoint}/login`,{body:{email:email,password:password}}).then(t=>e(loginSuccessful(t.token)),t=>e(loginFailed(t)))}}function syncLogout(){return{type:o}}function logoutSuccessful(){return{type:i}}function logout(){return e=>{return e(syncLogout()),Promise.resolve().then(()=>e(logoutSuccessful()))}}function selectPropByPath(e,t){let n,r;return"undefined"==typeof t?t:"string"==typeof e?selectPropByPath(e.split("."),t):(n=e[0],r=parseInt(n),isNaN(r)||(n=r),0===e.length?t:selectPropByPath(e.slice(1),t[n]))}function selectDataFromState(e,t){let n,r=t[I];return r&&(n=r.content[e]),n}function uidsToResponse(e,t){let{content}=t[I];return{items:e.map(e=>content[e])}}function findDataInState(e,t){let n,r,o=t[I],i=[];if(!o)return{items:[]};if({content:n,hierarchy:r}=o,e.parent){let t=selectPropByPath(e.parent,r);t&&(i=Object.keys(t).map(t=>`${e.parent}.${t}`))}else i=Object.keys(n);return uidsToResponse(i,t)}function storeToObserver(e){return{observe(...t){let n,r,o,i=t.pop(),u=t[0];return r=(()=>{return u?selectPropByPath(u,e.getState()):e.getState()}),n=r(),o=(()=>{let e=r();if(e!==n){let t=[e,n];n=e,i(...t)}}),{unobserve:e.subscribe(o)}}}}function matchesQuery(e={},t){return"undefined"!=typeof t&&null!==t&&(e.parent?t.id!==e.parent&&0===t.id.indexOf(e.parent):0===Object.keys(e).length)}function ensureActionMatches(e){return t=>{return t.type===e?Promise.resolve(t):Promise.reject(t)}}function runDispatchAndExpect(e,t,n){const r=e=>"undefined"!=typeof e.type&&"undefined"!=typeof e.response;return e(t).then(ensureActionMatches(n)).then(e=>e.response,e=>r(e)?Promise.reject(e.response):Promise.reject(e))}function dispatchThunkAndExpect(e,...t){return runDispatchAndExpect(e.dispatch,...t)}function clone(e){return JSON.parse(JSON.stringify(e))}function dataIsValid(e){let t=["type","data"],n=Object.keys(e||{});return 0!==n.length&&n.every(e=>t.indexOf(e)!==-1)}function toQueryParams(e={}){let t=(e,t)=>e<t?-1:e>t?1:0;return Object.keys(e).sort(t).reduce((t,n)=>{let r,o=e[n];return r=t?`${t}&`:"?",`${r}${n}=${encodeURIComponent(o)}`},"")}function hasRunQuery(e,t){const n=t[R],r=toQueryParams(e);return!!(n&&n[r]&&n[r].queriedRemote)}function makeBlankItem(){return{type:null,data:null}}function makeItemWith(e,t){return null===t?null:Object.assign(clone(t),{id:e})}function pathToUid(e){return e?(e=e.replace(/^\/+/,"").replace(/\/+$/,""),e.split("/").join(".")):e}function uidToPath(e){return e?("."!==e.charAt(0)&&(e=`.${e}`),e.split(".").join("/")):e}function itemUidToPath(e){let t,n;return e?(t=uidToPath(e.id),n=Object.assign({},e,{path:t}),delete n.id,n):e}function queryResultsToPath(e){let t;return e?(t=e.items.map(itemUidToPath),Object.assign({},e,{items:t})):e}function validatePath(e){if("/"!==e.charAt(0))throw new Error(`Invalid path ${e}. Path must be a string starting with '/'`);if(e.indexOf("//")!==-1)throw new Error(`Invalid path '${e}'. Paths must not have more than one '/' in a row.`)}function isInvalid(e){if("undefined"!=typeof e&&""===e)return"Invalid UID: Empty string is not a valid UID"}function formatAndRun({uid="",validateUid=true,query,endpoint:dataEndpoint,token,method,body}){const e=`${dataEndpoint}/${encodeURIComponent(uid)}${toQueryParams(query)}`,t=isInvalid(uid);return validateUid&&t?Promise.reject(new Error(t)):client[method](e,{body:body,token:token})}function generateHandler(e,t,[n,r,o],i){return(...u)=>(s,a)=>{let c,{config,token}=a(),f=config.dataEndpoint;return c=Object.assign({method:e,endpoint:f,token:token,validateUid:i},t(...u)),s(n(...u)),formatAndRun(c).then(e=>s(r(...u,e)),e=>s(o(...u,e)))}}function findData$$1(e){return{type:c,query:e}}function findDataSuccessful$$1(e,t){return{type:f,query:e,response:t}}function getData$$1(e){return{type:l,uid:e}}function getDataSuccessful$$1(e,t){return{type:d,response:t,uid:e}}function setData$$1(e,t){return{type:p,uid:e,data:t}}function setDataSuccessful$$1(e,t,n={}){n=Object.assign({persist:!0},n);let{persist}=n;return{type:h,response:makeItemWith(e,t),uid:e,persist:persist}}function setDataFailed$$1(e,t){return{type:y,response:t,uid:e}}function removeData$$1(e){return{type:m,uid:e}}function removeDataSuccessful$$1(e,t={}){t=Object.assign({persist:!0},t);let{persist}=t;return{type:g,uid:e,persist:persist}}function set$$1(e,t,n={}){n=Object.assign({validate:!0,createAncestry:!0,persist:!0},n);let{validate,createAncestry,persist}=n;return(n,r)=>{function o(e){let t=e.split(".").slice(0,-1).join(".");return!t||selectDataFromState(t,r())?Promise.resolve():runDispatchAndExpect(n,set$$1(t,makeBlankItem(t),{persist:!1}),h)}let i;if(n(setData$$1(e,t)),validate&&!dataIsValid(t))i=setDataFailed$$1(e,new Error(D));else{let n=selectDataFromState(e,r());t=Object.assign({},n,t),i=setDataSuccessful$$1(e,t,{persist:persist})}return(createAncestry?o(e):Promise.resolve()).then(()=>n(i))}}function remove$$1(e,t={}){t=Object.assign({persist:!0},t);let{persist}=t;return(t,n)=>{function r(e){if(!e)return Promise.resolve();let{items}=findDataInState({parent:e},n()),r=e=>{return runDispatchAndExpect(t,remove$$1(e.id,{persist:!1}),g)};return Promise.all(items.map(r))}return t(removeData$$1(e)),r(e).then(()=>t(removeDataSuccessful$$1(e,{persist:persist})))}}function get$$1(e){return(t,n)=>{let r,o,i;return t(getData$$1(e)),r=n(),o=selectDataFromState(e,r),i="undefined"==typeof o?runDispatchAndExpect(t,V(e),T).then(n=>{return runDispatchAndExpect(t,set$$1(e,n,{validate:!1,createAncestry:!1}),h)}):Promise.resolve(o),i.then(n=>t(getDataSuccessful$$1(e,n)))}}function find$$1(e={}){return(t,n)=>{let r,o,i;return t(findData$$1(e)),o=(e=>{return runDispatchAndExpect(t,set$$1(e.id,e,{validate:!1}),h)}),r=(e=>{let t=n(),r=({id:id})=>"undefined"==typeof selectDataFromState(id,t);return Promise.all(e.items.filter(r).map(o))}),i=(()=>{return Promise.resolve().then(()=>findDataInState(e,n())).then(n=>t(findDataSuccessful$$1(e,n)))}),hasRunQuery(e,n())?i():runDispatchAndExpect(t,z(e),b).then(r).then(i)}}function observeQuery(e){return{type:q,query:e}}function startSave(){return{type:u}}function saveSuccessful(){return{type:s}}function saveFailed(){return{type:a}}function save(){return(e,t)=>{let n,r,o,i,u;e(startSave());const s=t().save,a=Object.keys(s).map(e=>[e,s[e]]);return r=(([,{local:local,changed:changed}])=>null===local&&changed),o=(([,{local:local,changed:changed}])=>null!==local&&changed),n=(t=>{return runDispatchAndExpect(e,set$$1(t.id,t,{validate:!1}),h)}),i=a.filter(o).map(([e,{local:local}])=>X(e,local)).map(t=>{return runDispatchAndExpect(e,t,_).then(n)}),u=a.filter(r).map(([e])=>Y(e)).map(t=>runDispatchAndExpect(e,t,E)),Promise.all([...i,...u]).then(()=>e(saveSuccessful()),()=>e(saveFailed()))}}function configurePolymer(){window.Polymer=window.Polymer||{dom:"shadow"}}function tokenIsValid(e){const t=(new Date).getTime()/1e3;let n;if(!e)return!1;try{let[,t]=e.split(".");n=JSON.parse(atob(t))}catch(e){return console.warn(oe,e.message),!1}return!(n.exp&&t>n.exp)&&!(!n.iss||n.iss!==ee)}function setTokenToStorage(e){if(e)try{window.localStorage.setItem(Z,e)}catch(e){console.warn(te)}else try{window.localStorage.removeItem(Z)}catch(e){console.warn(re)}}function readTokenFromStorage(e){let t;try{t=window.localStorage.getItem(Z)}catch(e){t=!1,console.log(ne)}if(tokenIsValid(t))e._store.dispatch(loginSuccessful(t));else try{window.localStorage.removeItem(Z)}catch(e){console.warn(re)}}function authenticated(e=false,t){switch(t.type){case n:return!0;case i:return!1;default:return e}}function options(t={},n){switch(n.type){case e:return Object.assign({},t,{[n.prop]:n.value});default:return t}}function updateStateWithQuery(e,t,n){return Object.assign({},e,{[t]:Object.assign({},e[t],n)})}function queries(e={},t){let n;switch(t.type){case c:return n=toQueryParams(t.query),e[n]?e[n].querying?e:updateStateWithQuery(e,n,{querying:!0}):updateStateWithQuery(e,n,{query:t.query,querying:!0,queriedRemote:!1,cache:[],matches:[]});case f:if(n=toQueryParams(t.query),0!==e[n].cache.length){let t,{matches,cache}=e[n];if(t=[...matches,...cache.filter(ie(matches))],t.length!==matches.length)return updateStateWithQuery(e,n,{querying:!1,cache:[],matches:t})}return updateStateWithQuery(e,n,{cache:[],querying:!1});case b:return n=toQueryParams(t.query),e[n].queriedRemote?e:updateStateWithQuery(e,n,{queriedRemote:!0});case q:return n=toQueryParams(t.query),e[n]?e:updateStateWithQuery(e,n,{query:t.query,querying:!1,queriedRemote:!1,cache:[],matches:[]});case h:return Object.keys(e).reduce((e,n)=>{let r,{query,matches,cache,querying}=e[n],{response,uid}=t,o=querying?cache:matches;return r=matchesQuery(query,response)?[...o,uid]:o.filter(ue(uid)),r.length!==o.length?updateStateWithQuery(e,n,{[querying?"cache":"matches"]:r}):e},e);case g:return Object.keys(e).reduce((e,n)=>{let r,{matches}=e[n],{uid}=t;return r=matches.filter(ue(uid)),r!==matches.length?updateStateWithQuery(e,n,{matches:r}):e},e);default:return e}}function editable(e=se,t){switch(t.type){case x:return!0;case k:return!1;default:return e}}function equal(e,t){return JSON.stringify(e)===JSON.stringify(t)}function markAt(e,t){let n=t[0],r=1===t.length?{}:markAt(e[n]||{},t.slice(1));return Object.assign({},e,{[n]:r})}function pruneAt(e,t){let n=t[0];if(1===t.length){let t=Object.assign({},e);return delete t[n],t}return e.hasOwnProperty(n)?Object.assign({},e,{[n]:pruneAt(e[n],t.slice(1))}):e}function hierarchy(e={},t){switch(t.type){case h:return markAt(e,t.uid.split("."),{});case g:return pruneAt(e,t.uid.split("."));default:return e}}function content(e={},t){switch(t.type){case h:let n=e[t.uid],r=clone(t.response);return equal(n,r)?e:Object.assign({},e,{[t.uid]:clone(t.response)});case g:return null===e[t.uid]?e:Object.assign({},e,{[t.uid]:null});default:return e}}function token(e=null,t){switch(t.type){case n:return t.response;case o:return null;default:return e}}function isDifferent(e,t){let n=JSON.stringify(e),r=JSON.stringify(t);return n!==r}function reducePart(e={},t,n){let{local,remote,changed}=e;return n?remote=clone(t||null):local=clone(t||null),changed=isDifferent(remote,local),Object.assign({},e,{local:local,remote:remote,changed:changed})}function save$1(e={},t){let n,r,o;switch(n=(t=>(n,r,o)=>{let i=n[r],u=reducePart(n[r],o,t);return i===u?e:Object.assign({},n,{[r]:u})}),r=n(!1),o=n(!0),t.type){case b:return t.response.items.reduce((e,t)=>{return o(e,t.id,t)},e);case T:case _:return o(e,t.uid,t.response);case E:return o(e,t.uid,null);case h:return t.persist?r(e,t.uid,t.response):e;case g:if(!t.persist){let n=Object.assign({},e);return delete n[t.uid],n}return r(e,t.uid,t.response);default:return e}}var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},es6Promise=createCommonjsModule(function(e,t){!function(t,n){e.exports=n()}(commonjsGlobal,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function n(e){H=e}function r(e){J=e}function o(){return function(){return process.nextTick(c)}}function i(){return"undefined"!=typeof B?function(){B(c)}:a()}function u(){var e=0,t=new Y(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function s(){var e=new MessageChannel;return e.port1.onmessage=c,function(){return e.port2.postMessage(0)}}function a(){var e=setTimeout;return function(){return e(c,1)}}function c(){for(var e=0;e<G;e+=2){var t=Z[e],n=Z[e+1];t(n),Z[e]=void 0,Z[e+1]=void 0}G=0}function f(){try{var e=commonjsRequire,t=e("vertx");return B=t.runOnLoop||t.runOnContext,i()}catch(e){return a()}}function l(e,t){var n=arguments,r=this,o=new this.constructor(p);void 0===o[te]&&q(o);var i=r._state;return i?!function(){var e=n[i-1];J(function(){return A(i,o,e,r._result)})}():_(r,o,e,t),o}function d(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(p);return j(n,e),n}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return ie.error=e,ie}}function g(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function v(e,t,n){J(function(e){var r=!1,o=g(n,t,function(n){r||(r=!0,t!==n?j(e,n):S(e,n))},function(t){r||(r=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,O(e,o))},e)}function b(e,t){t._state===re?S(e,t._result):t._state===oe?O(e,t._result):_(t,void 0,function(t){return j(e,t)},function(t){return O(e,t)})}function w(e,n,r){n.constructor===e.constructor&&r===l&&n.constructor.resolve===d?b(e,n):r===ie?(O(e,ie.error),ie.error=null):void 0===r?S(e,n):t(r)?v(e,n,r):S(e,n)}function j(t,n){t===n?O(t,h()):e(n)?w(t,n,m(n)):S(t,n)}function T(e){e._onerror&&e._onerror(e._result),P(e)}function S(e,t){e._state===ne&&(e._result=t,e._state=re,0!==e._subscribers.length&&J(P,e))}function O(e,t){e._state===ne&&(e._state=oe,e._result=t,J(T,e))}function _(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+re]=n,o[i+oe]=r,0===i&&e._state&&J(P,e)}function P(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,u=0;u<t.length;u+=3)r=t[u],o=t[u+n],r?A(n,r,o,i):o(i);e._subscribers.length=0}}function $(){this.error=null}function E(e,t){try{return e(t)}catch(e){return ue.error=e,ue}}function A(e,n,r,o){var i=t(r),u=void 0,s=void 0,a=void 0,c=void 0;if(i){if(u=E(r,o),u===ue?(c=!0,s=u.error,u.error=null):a=!0,n===u)return void O(n,y())}else u=o,a=!0;n._state!==ne||(i&&a?j(n,u):c?O(n,s):e===re?S(n,u):e===oe&&O(n,u))}function x(e,t){try{t(function(t){j(e,t)},function(t){O(e,t)})}catch(t){O(e,t)}}function k(){return se++}function q(e){e[te]=se++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(p),this.promise[te]||q(this.promise),L(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):O(this.promise,I())}function I(){return new Error("Array Methods must be provided an Array")}function R(e){return new D(this,e).promise}function M(e){var t=this;return new t(L(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function U(e){var t=this,n=new t(p);return O(n,e),n}function C(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Q(e){this[te]=k(),this._result=this._state=void 0,this._subscribers=[],p!==e&&("function"!=typeof e&&C(),this instanceof Q?x(this,e):N())}function F(){var e=void 0;if("undefined"!=typeof commonjsGlobal)e=commonjsGlobal;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=Q}var W=void 0;W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var L=W,G=0,B=void 0,H=void 0,J=function(e,t){Z[G]=e,Z[G+1]=t,G+=2,2===G&&(H?H(c):ee())},V="undefined"!=typeof window?window:void 0,X=V||{},Y=X.MutationObserver||X.WebKitMutationObserver,z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3),ee=void 0;ee=z?o():Y?u():K?s():void 0===V&&"function"==typeof commonjsRequire?f():a();var te=Math.random().toString(36).substring(16),ne=void 0,re=1,oe=2,ie=new $,ue=new $,se=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ne&&n<e;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===d){var o=m(e);if(o===l&&e._state!==ne)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===Q){var i=new n(p);w(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ne&&(this._remaining--,e===oe?O(r,n):this._result[t]=n),0===this._remaining&&S(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;_(e,void 0,function(e){return n._settledAt(re,t,e)},function(e){return n._settledAt(oe,t,e)})},Q.all=R,Q.race=M,Q.resolve=d,Q.reject=U,Q._setScheduler=n,Q._setAsap=r,Q._asap=J,Q.prototype={constructor:Q,then:l,catch:function(e){return this.then(null,e)}},Q.polyfill=F,Q.Promise=Q,Q})}),auto=es6Promise.polyfill(),freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol=root.Symbol,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty,nativeObjectToString=objectProto$1.toString,symToStringTag$1=Symbol?Symbol.toStringTag:void 0,objectProto$2=Object.prototype,nativeObjectToString$1=objectProto$2.toString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol?Symbol.toStringTag:void 0,getPrototype=overArg(Object.getPrototypeOf,Object),objectTag="[object Object]",funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object),ponyfill=createCommonjsModule(function(e,t){"use strict";function n(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}),index$1=createCommonjsModule(function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(ponyfill);r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof commonjsGlobal?commonjsGlobal:e;var i=(0,o.default)(r);t.default=i}),index=index$1,ActionTypes={INIT:"@@redux/INIT"},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};const e="set-option",t="login",n="login-successful",r="login-failed",o="logout",i="logout-successful",u="save",s="save-successful",a="save-failed",c="find-data",f="find-data-successful",l="get-data",d="get-data-successful",p="set-data",h="set-data-successful",y="set-data-failed",m="remove-data",g="remove-data-successful",v="find-data-from-api",b="find-data-from-api-successful",w="find-data-from-api-failed",j="get-data-from-api",T="get-data-from-api-successful",S="get-data-from-api-failed",O="set-data-to-api",_="set-data-to-api-successful",P="set-data-to-api-failed",$="remove-data-from-api",E="remove-data-from-api-successful",A="remove-data-from-api-failed",x="edit-active",k="edit-inactive",q="observe-query";var index$3="function"==typeof fetch?fetch:function(e,t){return t=t||{},new Promise(function(n,r){function o(){var e,t=[],n=[],r={};return i.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(o,i,u){t.push(i=i.toLowerCase()),n.push([i,u]),e=r[i],r[i]=e?e+","+u:u}),{ok:1==(i.status/200|0),status:i.status,statusText:i.statusText,url:i.responseURL,clone:o,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},xml:function(){return Promise.resolve(i.responseXML)},blob:function(){return Promise.resolve(new Blob([i.response]))},headers:{keys:function(){return t},entries:function(){return n},get:function(e){return r[e.toLowerCase()]},has:function(e){return e.toLowerCase()in r}}}}var i=new XMLHttpRequest;i.open(t.method||"get",e);for(var u in t.headers)i.setRequestHeader(u,t.headers[u]);i.withCredentials="include"==t.credentials,i.onload=function(){n(o())},i.onerror=r,i.send(t.body)})},fetch$1=(...e)=>window.fetch?window.fetch(...e):index$3(...e),client={get(e,t){return request(Object.assign({method:"GET"},t,{url:e}))},post(e,t){return requestWithToken(Object.assign({method:"POST"},t,{url:e}))},put(e,t){return requestWithToken(Object.assign({method:"PUT"},t,{url:e}))},delete(e,t){return requestWithToken(Object.assign({method:"DELETE"},t,{url:e}))}};const D="Invalid content: only type and data properties are allowed",I="_data",R="_queries",M=e=>({type:v,query:e}),U=(e,t)=>({type:b,query:e,response:t}),C=(e,t)=>({type:w,query:e,response:t}),N=e=>({type:j,uid:e}),Q=(e,t)=>({type:T,uid:e,response:t}),F=(e,t)=>({type:S,uid:e,response:t}),W=(e,t)=>({type:O,uid:e,body:t}),L=(e,t,n)=>({type:_,uid:e,body:t,response:n}),G=(e,t,n)=>({type:P,uid:e,body:t,response:n}),B=e=>({type:$,uid:e}),H=(e,t)=>({type:E,uid:e,response:t}),J=(e,t)=>({type:A,uid:e,response:t}),V=generateHandler("get",e=>({uid:e}),[N,Q,F]),X=generateHandler("put",(e,t)=>({uid:e,body:t}),[W,L,G]),Y=generateHandler("delete",e=>({uid:e}),[B,H,J]),z=generateHandler("get",e=>({query:e}),[M,U,C],!1),K="https://api.simpla.io";var ping=function(e){let t,n;n=(({authEndpoint:authEndpoint,project:project})=>{return!(!authEndpoint||!project)&&(fetch$1(`${authEndpoint}/projects/${project}/sessions`,{method:"POST"}),t&&t.unobserve(),!0)}),n(e.getState("config"))||(t=e.observeState("config",n))};const Z="simpla-token",ee="https://simpla.auth0.com/",te="Could not remember login token. Are you in Private Mode?",ne="Could not load login token from storage. Are you in Private Mode?",re="Could not logout. Are you in Private Mode?",oe="Invalid token";var persistToken=function(e){readTokenFromStorage(e),e.observeState("token",setTokenToStorage)},index$4=createCommonjsModule(function(e,t){"use strict";function n(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(o){return"function"==typeof o?o(n,r,e):t(o)}}}}t.__esModule=!0;var r=n();r.withExtraArgument=n,t.default=r}),thunk=unwrapExports(index$4);const ie=e=>t=>e.indexOf(t)===-1,ue=e=>t=>e!==t,se=!1;var data=combineReducers({hierarchy:hierarchy,content:content});const ae=combineReducers({[I]:data,[R]:queries,authenticated:authenticated,config:options,editable:editable,token:token,save:save$1});configurePolymer();const ce=new class e{constructor(){const e=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;this._store=createStore(ae,e(applyMiddleware(thunk)))}init(e){this._store.dispatch(setOption("project",e)),this._store.dispatch(setOption("authEndpoint",K)),this._store.dispatch(setOption("dataEndpoint",`${K}/projects/${e}/content`))}login(...e){return dispatchThunkAndExpect(this._store,login(...e),n)}logout(...e){return dispatchThunkAndExpect(this._store,logout(...e),i)}find(e={}){let t=e.parent;return e.parent=pathToUid(t),Promise.resolve().then(()=>validatePath(t)).then(()=>dispatchThunkAndExpect(this._store,find$$1(e),f)).then(queryResultsToPath)}get(e,...t){const n=pathToUid(e);return Promise.resolve().then(()=>validatePath(e)).then(()=>dispatchThunkAndExpect(this._store,get$$1(n,...t),d)).then(itemUidToPath)}set(e,...t){const n=pathToUid(e);return Promise.resolve().then(()=>validatePath(e)).then(()=>dispatchThunkAndExpect(this._store,set$$1(n,...t),h)).then(itemUidToPath)}remove(e,...t){const n=pathToUid(e);return Promise.resolve().then(()=>validatePath(e)).then(()=>dispatchThunkAndExpect(this._store,remove$$1(n,...t),g)).then(itemUidToPath)}observe(e,...t){let n,r,o=t.pop(),i=pathToUid(e);if(!i)throw new Error("Observe must be given a valid path");return validatePath(e),n=[I,"content",i],r=(()=>this.get(e).then(o)),storeToObserver(this._store).observe(n,r)}observeQuery(e,t){let n,r,o;return e.parent=pathToUid(e.parent),n=toQueryParams(e),r=[R,n,"matches"],this._store.dispatch(observeQuery(e)),o=(e=>{return t(queryResultsToPath(uidsToResponse(e,this.getState())))}),storeToObserver(this._store).observe(r,o)}save(...e){return dispatchThunkAndExpect(this._store,save(...e),s)}editable(e){this._store.dispatch(e?editActive():editInactive())}getState(e){let t=this._store.getState();return e?selectPropByPath(e,t):t}observeState(...e){return storeToObserver(this._store).observe(...e)}},fe=[ping,persistToken];fe.forEach(e=>e(ce)),ce.init("demo"),window.Simpla=ce,Polymer({is:"simpla-demo-helper",properties:{editable:{type:Boolean,observer:"_updateEditable",value:!0}},_updateEditable:function(e){ce.editable(e)}}); </script> </dom-module> 